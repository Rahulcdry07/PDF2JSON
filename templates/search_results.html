{% extends "base.html" %}

{% block title %}Search Results - {{ search_term }} - EstimateX{% endblock %}

{% block content %}
<div class="container">
    <nav style="margin-bottom: 20px; color: #6c757d;">
        <a href="/" style="color: #007bff; text-decoration: none;">Home</a> / 
        <a href="/search" style="color: #007bff; text-decoration: none;">Search</a> / 
        <span>Results</span>
    </nav>

    <div class="page-header">
        <h1>ğŸ” Search Results</h1>
        <p>Results for: <strong>"{{ search_term }}"</strong></p>
    </div>

    <!-- New Search -->
    <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 30px;">
        <form method="POST" action="/search" style="display: flex; gap: 10px; align-items: center;">
            <input 
                type="text" 
                name="search_term" 
                value="{{ search_term }}"
                placeholder="Enter new search term..."
                style="flex: 1; padding: 10px; border: 2px solid #dee2e6; border-radius: 6px; font-size: 14px;"
            />
            <button 
                type="submit"
                style="background: #17a2b8; color: white; padding: 10px 24px; border: none; border-radius: 6px; font-weight: 500; cursor: pointer; white-space: nowrap;"
            >
                ğŸ” Search Again
            </button>
        </form>
    </div>

    <!-- Results -->
    {% if results %}
        <div style="background: #d4edda; border-left: 4px solid #28a745; padding: 15px; border-radius: 8px; margin-bottom: 25px;">
            <strong style="color: #155724;">âœ… Found {{ results|length }} file(s) with matches</strong>
        </div>

        {% for result in results %}
        <div style="background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px;">
            <h3 style="color: #007bff; margin-bottom: 10px; font-size: 1.3rem;">
                <a href="/view/{{ result.filepath }}" style="color: #007bff; text-decoration: none;">
                    ğŸ“„ {{ result.filename }}
                </a>
                <span style="color: #6c757d; font-size: 0.9rem; font-weight: normal; margin-left: 10px;">
                    ({{ result.total_matches }} match{{ 'es' if result.total_matches != 1 else '' }})
                </span>
            </h3>
            
            <div style="margin-top: 15px;">
                {% for match_idx, match_text in result.matches %}
                <div style="background: #fff9e6; border-left: 3px solid #ffc107; padding: 12px; margin-bottom: 8px; border-radius: 4px;">
                    <a href="/view/{{ result.filepath }}?search={{ search_term }}" style="text-decoration: none; color: #333;">
                        {{ match_text }}
                    </a>
                </div>
                {% endfor %}
                
                {% if result.total_matches > result.matches|length %}
                <div style="color: #6c757d; font-style: italic; margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                    ğŸ“‹ ... and {{ result.total_matches - result.matches|length }} more match{{ 'es' if (result.total_matches - result.matches|length) != 1 else '' }} in this file
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 20px; border-radius: 8px;">
            <h3 style="color: #856404; margin-bottom: 10px;">âš ï¸ No matches found</h3>
            <p style="color: #856404; margin: 0;">
                No results found for "<strong>{{ search_term }}</strong>". Try:
            </p>
            <ul style="color: #856404; margin-top: 10px;">
                <li>Using different keywords</li>
                <li>Checking your spelling</li>
                <li>Using more general terms</li>
                <li>Searching for item codes or categories</li>
            </ul>
        </div>
    {% endif %}

    <!-- Back Button -->
    <div style="margin-top: 30px; text-align: center;">
        <a href="/search" style="display: inline-block; background: #6c757d; color: white; padding: 12px 30px; border-radius: 6px; text-decoration: none; font-weight: 500;">
            â† Back to Search
        </a>
    </div>
</div>
{% endblock %}